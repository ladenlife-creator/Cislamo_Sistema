<div class="app-layout">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div class="logo">üïå</div>
            <h1 class="brand-name">ERP CISLAMO</h1>
        </div>
        
        <nav class="sidebar-nav">
            <a ng-click="goTo('/dashboard')" class="nav-item" ng-class="{'active': $location.path() === '/dashboard'}">
                <span class="nav-icon">üìä</span>
                <span class="nav-label">Dashboard</span>
            </a>
            <a ng-click="goTo('/users')" class="nav-item" ng-class="{'active': $location.path() === '/users'}">
                <span class="nav-icon">üë•</span>
                <span class="nav-label">Utilizadores</span>
            </a>
            <a ng-click="goTo('/documents')" class="nav-item" ng-class="{'active': $location.path() === '/documents'}">
                <span class="nav-icon">üìÑ</span>
                <span class="nav-label">Documentos</span>
            </a>
            <a ng-click="goTo('/events')" class="nav-item" ng-class="{'active': $location.path() === '/events'}">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-label">Eventos</span>
            </a>
        </nav>
        
        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar">{{ (currentUser && currentUser.name) ? currentUser.name.charAt(0).toUpperCase() : 'U' }}</div>
                <div class="user-details">
                    <div class="user-name">{{ (currentUser && currentUser.name) || 'Usu√°rio' }}</div>
                    <div class="user-email">{{ (currentUser && (currentUser.identifier || currentUser.email)) || '' }}</div>
                </div>
            </div>
            <button class="btn-logout" ng-click="logout()">
                <span>Sair</span>
            </button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <div class="dashboard-content">
        <div class="container">
            <div class="page-header">
                <h1>Gest√£o de Documentos</h1>
                <div class="page-header-actions">
                    <button class="btn btn-secondary" ng-click="toggleFilters()">
                        <span ng-if="!showFilters">üîç</span>
                        <span ng-if="showFilters">‚úï</span>
                        {{ showFilters ? 'Ocultar Filtros' : 'Filtros' }}
                    </button>
                    <button class="btn btn-primary" ng-click="toggleForm()">
                        {{ showForm ? 'Cancelar' : '+ Novo Documento' }}
                    </button>
                </div>
            </div>

            <!-- Filtros -->
            <div class="filters-card" ng-if="!loading && allDocuments.length > 0 && showFilters">
                <h3>Filtros</h3>
                <div class="filters-grid">
                    <div class="form-group">
                        <label>Buscar</label>
                        <input type="text" ng-model="filters.search" ng-change="applyFilters()" placeholder="Buscar por t√≠tulo ou descri√ß√£o..." class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select ng-model="filters.category" ng-change="applyFilters()" class="form-control">
                            <option ng-repeat="option in categoryOptions" value="{{ option.value }}">
                                {{ option.label }}
                            </option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Data de Cria√ß√£o (De)</label>
                        <input type="date" ng-model="filters.dateFrom" ng-change="applyFilters()" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>Data de Cria√ß√£o (At√©)</label>
                        <input type="date" ng-model="filters.dateTo" ng-change="applyFilters()" class="form-control">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button type="button" ng-click="clearFilters()" class="btn btn-secondary" style="width: 100%;">
                            Limpar Filtros
                        </button>
                    </div>
                </div>
                <div class="filters-info" ng-if="documents.length !== allDocuments.length">
                    <p>Mostrando {{ documents.length }} de {{ allDocuments.length }} documentos</p>
                </div>
            </div>

            <div class="form-card" ng-if="showForm">
                <h3>Novo Documento</h3>
                <form ng-submit="createDocument()">
                    <div class="form-group">
                        <label>T√≠tulo *</label>
                        <input type="text" ng-model="newDocument.title" required class="form-control" placeholder="Digite o t√≠tulo do documento">
                    </div>
                    <div class="form-group">
                        <label>Descri√ß√£o</label>
                        <textarea ng-model="newDocument.description" class="form-control" rows="4" placeholder="Digite uma descri√ß√£o para o documento"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Categoria</label>
                        <select ng-model="newDocument.category" class="form-control">
                            <option value="">Selecione uma categoria</option>
                            <option value="Relat√≥rio">Relat√≥rio</option>
                            <option value="Manual">Manual</option>
                            <option value="Pol√≠tica">Pol√≠tica</option>
                            <option value="Contrato">Contrato</option>
                            <option value="Plano">Plano</option>
                            <option value="Or√ßamento">Or√ßamento</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Arquivo (opcional)</label>
                        <input type="file" id="fileInput" onchange="angular.element(this).scope().onFileSelect(this)" class="form-control" accept=".pdf,.doc,.docx,.xls,.xlsx,.txt">
                        <small class="form-text text-muted">Formatos suportados: PDF, DOC, DOCX, XLS, XLSX, TXT</small>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" ng-click="toggleForm()">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary" ng-disabled="!newDocument.title">
                            Criar Documento
                        </button>
                    </div>
                </form>
            </div>

            <div class="documents-grid" ng-if="!loading">
                <div class="document-card" ng-repeat="doc in documents track by doc.id" ng-click="viewDocument(doc)" style="cursor: pointer;">
                    <div class="document-icon">üìÑ</div>
                    <div class="document-info">
                        <h3>{{ doc.title || 'Sem t√≠tulo' }}</h3>
                        <p>{{ doc.description || 'Sem descri√ß√£o' }}</p>
                        <div class="document-meta">
                            <span>Categoria: {{ doc.category || 'N/A' }}</span>
                            <span ng-if="doc.user && doc.user.name">Por: {{ doc.user.name }}</span>
                            <span ng-if="!doc.user || !doc.user.name">Por: Sistema</span>
                        </div>
                    </div>
                    <div class="document-actions" ng-click="$event.stopPropagation()">
                        <button class="btn btn-sm btn-danger" ng-click="deleteDocument(doc.id, $event)" title="Remover">
                            Remover
                        </button>
                    </div>
                </div>
                <p ng-if="!loading && documents.length === 0" class="empty-message">
                    Nenhum documento encontrado.
                </p>
            </div>

            <div class="loading" ng-if="loading">
                Carregando...
            </div>
            
            <!-- Modal para visualizar documento sem arquivo -->
            <div class="modal-overlay" ng-if="showDocumentModal" ng-click="closeDocumentModal()">
                <div class="modal-content" ng-click="$event.stopPropagation()">
                    <div class="modal-header">
                        <h2>{{ selectedDocument.title || 'Detalhes do Documento' }}</h2>
                        <button class="modal-close" ng-click="closeDocumentModal()">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="document-detail-item">
                            <strong>T√≠tulo:</strong>
                            <p>{{ selectedDocument.title || 'Sem t√≠tulo' }}</p>
                        </div>
                        <div class="document-detail-item">
                            <strong>Descri√ß√£o:</strong>
                            <p>{{ selectedDocument.description || 'Sem descri√ß√£o' }}</p>
                        </div>
                        <div class="document-detail-item">
                            <strong>Categoria:</strong>
                            <p>{{ selectedDocument.category || 'N/A' }}</p>
                        </div>
                        <div class="document-detail-item">
                            <strong>Criado por:</strong>
                            <p>{{ selectedDocument.user ? selectedDocument.user.name : 'Sistema' }}</p>
                        </div>
                        <div class="document-detail-item" ng-if="selectedDocument.created_at">
                            <strong>Data de Cria√ß√£o:</strong>
                            <p>{{ selectedDocument.created_at | date:'dd/MM/yyyy HH:mm' }}</p>
                        </div>
                        <div class="document-info-message">
                            <p>‚ÑπÔ∏è Este documento n√£o possui arquivo anexado.</p>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" ng-click="closeDocumentModal()">Fechar</button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

